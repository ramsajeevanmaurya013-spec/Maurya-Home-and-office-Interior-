
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Maurya Interior – Customer Reviews</title>
  <style>
    body{font-family:Arial, sans-serif; padding:18px; background:#f5f5f5; color:#222}
    .card{background:#fff;border-radius:8px;padding:14px;margin:12px 0;box-shadow:0 1px 4px rgba(0,0,0,0.08)}
    #star-select span{font-size:30px;cursor:pointer;margin-right:4px}
    #preview-photos img{width:72px;height:72px;object-fit:cover;border-radius:6px;margin:6px}
    .small{font-size:13px;color:#555}
    .rev-card{margin-bottom:12px}
    .rev-card .stars{color:#ff9500;font-size:20px;margin-bottom:5px}
    button{background:#0078ff;color:#fff;border:0;padding:8px 12px;border-radius:6px;cursor:pointer;margin-top:8px}
    button:disabled{opacity:0.6}
  </style>
</head>
<body>
<h1>Customer Reviews</h1>
<div class="card">
  <strong>Rate our Service</strong>
  <div id="star-select" style="margin-top:8px;">
    <span data-value="1">☆</span>
    <span data-value="2">☆</span>
    <span data-value="3">☆</span>
    <span data-value="4">☆</span>
    <span data-value="5">☆</span>
  </div>
  <textarea id="review-text" rows="3" placeholder="Write your review..." style="width:100%;margin-top:10px;padding:8px;border-radius:6px;border:1px solid #ccc"></textarea>
  <label class="small">Upload photos (max 5)</label><br>
  <input id="review-photos" type="file" accept="image/*" multiple />
  <div id="preview-photos"></div>
  <button id="submitBtn">Submit Review</button>
  <span id="status" class="small"></span>
</div>
<h2>All Reviews</h2>
<div id="all-reviews"></div>
<!-- FIREBASE SCRIPTS -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
  import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";
  import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-storage.js";
  // YOUR FIREBASE CONFIG (already filled)
  const firebaseConfig = {
    apiKey: "AIzaSyCcgGn8TrzWXhehhplnmMwnO9CzWi0poUA",
    authDomain: "maurya-interior.firebaseapp.com",
    databaseURL: "https://maurya-interior-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "maurya-interior",
    storageBucket: "maurya-interior.firebasestorage.app",
    messagingSenderId: "289546553710",
    appId: "1:289546553710:web:6902612a1c41749832597f",
    measurementId: "G-JKMR9GLQQQ"
  };
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const storage = getStorage(app);
  let selectedRating = 0;
  // STAR SELECT
  const starsEl = document.getElementById("star-select");
  starsEl.querySelectorAll("span").forEach(s=>{
    s.addEventListener("click", ()=>{
      selectedRating = Number(s.dataset.value);
      renderStars();
    });
  });
  function renderStars(){
    starsEl.querySelectorAll("span").forEach(s=>{
      s.textContent = (Number(s.dataset.value) <= selectedRating) ? "★" : "☆";
    });
  }
  // PHOTO PREVIEW
  const preview = document.getElementById("preview-photos");
  const photos = document.getElementById("review-photos");
  photos.addEventListener("change", ()=>{
    preview.innerHTML = "";
    [...photos.files].slice(0,5).forEach(f=>{
      const img = document.createElement("img");
      img.src = URL.createObjectURL(f);
      preview.appendChild(img);
    });
  });
  // SUBMIT REVIEW
  document.getElementById("submitBtn").addEventListener("click", async ()=>{
    if(!selectedRating) return alert("Please select a rating!");
    const text = document.getElementById("review-text").value;
    const files = photos.files;
    const status = document.getElementById("status");
    status.textContent = "Uploading...";
    status.style.color = "green";
    let photoUrls = [];
    for(let i=0;i<Math.min(5,files.length);i++){
      const f = files[i];
      const fileRef = sRef(storage, "reviews/" + Date.now() + "_" + f.name);
      await uploadBytes(fileRef, f);
      const url = await getDownloadURL(fileRef);
      photoUrls.push(url);
    }
    await push(ref(db, "reviews"), {
      rating: selectedRating,
      text,
      photos: photoUrls,
      timestamp: Date.now()
    });
    status.textContent = "Review submitted!";
    // RESET FORM
    selectedRating = 0;
    renderStars();
    document.getElementById("review-text").value = "";
    photos.value = "";
    preview.innerHTML = "";
    setTimeout(()=> status.textContent = "", 2000);
  });
  // SHOW ALL REVIEWS
  const allReviews = document.getElementById("all-reviews");
  onValue(ref(db, "reviews"), snap=>{
    allReviews.innerHTML = "";
    let items = [];
    snap.forEach(s=> items.push(s.val()));
    items.sort((a,b)=> b.timestamp - a.timestamp);
    items.forEach(r=>{
      const card = document.createElement("div");
      card.className = "card rev-card";
      const stars = "★".repeat(r.rating) + "☆".repeat(5-r.rating);
      let imgs = "";
      if(r.photos){
        r.photos.forEach(p=>{
          imgs += `<img src="${p}" style="width:80px;margin:5px;border-radius:6px">`;
        });
      }
      card.innerHTML = `
        <div class="stars">${stars}</div>
        <p>${r.text || ""}</p>
        <div>${imgs}</div>
        <div class="small">${new Date(r.timestamp).toLocaleString()}</div>
      `;
      allReviews.appendChild(card);
    });
  });
</script>
</body>
</html>